---
import Layout from '/src/layouts/docs.astro'
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const articles = await getCollection('reference');

  return articles.map(entry => {
    const [_, version, slug] = entry.slug.match(/(.+?)\/(.+)/)

    return {
      params: { version, slug }, props: { entry, version, slug },
    }});
}

import ReferenceNav from '/src/components/reference/nav.astro'
import NextPrevPage from '/src/components/reference/next-prev-page.astro';
import TableOfContents from '/src/components/table-of-contents.astro'

const { entry, version, slug } = Astro.props;
const { Content, headings } = await entry.render();
const toc = {items: headings}
---

<Layout>
    <div class="grid grid-cols-1 lg:grid-cols-[12rem_1fr_12rem] gap-4 my-4 lg:my-8 mx-auto">
        <ReferenceNav version={version} slug={slug}/>

        <div class="doc-container prose dark:prose-invert max-w-none">
          <Content />
          <NextPrevPage version={version} slug={slug} />
        </div>

        <aside class="lg:top-[130px] lg:block lg:h-fit overflow-scroll lg:sticky lg:overflow-auto row-start-2 lg:row-auto"><TableOfContents toc={toc} /></aside>
    </div>
</Layout>
